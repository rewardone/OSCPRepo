<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>NX bit</title>
</head><body><span style="font-family: sans"><span style="font-size: 10pt"><div style="text-align: left">DEP/NX works very simply: If memory is R/W, then it can't be X. If memory is R/X, then it can't be W. So if we can WRITE to the memory (stack) then we can't EXECUTE it. (hence the segmentation fault). If we can EXECUTE it, we can't WRITE to it. </div><br/>
<br/>
<div style="text-align: left">So I started looking into the option to exploit this "NX bit" and whether I could program around it: Enter ROP! ROP stands for Return Oriented Programming. Where normal programs use the EIP address to point to the next instruction, ROP uses the ESP address to point to the next instruction. How can this be? Well, it turns out that any "RET" instruction in programs look up the original source address which they get from the ESP, not the EIP. So while normally we'd try to control the flow of a program with EIP, with ROP we try and control the flow of the program with ESP. Let me explain:</div><br/>
<br/>
<div style="text-align: left">Normal execution: MOV EAX,1 -&gt; EIP increased by one which points to the next instruction -&gt; MOV EBX,1 -&gt; EIP increased by one which points to the next instruction etc</div><br/>
<div style="text-align: left">ROP execution: ESP points to RET -&gt; return address taken from ESP stack -&gt; ESP points to another RET -&gt; EIP never gets a chance to play</div>&nbsp; <br/>
<br/>
<div style="text-align: left">So what good is it to execute RET instructions the whole time? Well not much. But here comes the genius: If we can find OTHER instructions just before the RET instructions, we can have the system execute those instructions, the RET will be next which we control because we control the ESP stack. We can't WRITE the instructions we're using, but we can EXECUTE them (and as such, DEP allows us to execute). </div>&nbsp; </span></span></body></html>