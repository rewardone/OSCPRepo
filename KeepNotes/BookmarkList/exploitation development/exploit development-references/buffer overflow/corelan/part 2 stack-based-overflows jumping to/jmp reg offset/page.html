<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>JMP Reg Offset</title>
</head><body>Another technique to overcome the problem that the shellcode begins at an offset of a register (ESP in our example) is by trying to find a jmp [reg + offset] instruction (and overwriting EIP with the address of that instruction). Let’s assume that we need to jump 8 bytes again (see previous exercise). Using the jmp reg+offset technique, we would simply jump over the 8 bytes at the beginning of ESP and land directly at our shellcode.<br/>
<br/>
We need to do 3 things :<br/>
<ul><li>find the opcode for jmp esp+8h</li>
<li>find an address that points to this instruction</li>
<li>craft the exploit so it overwrites EIP with this address</li>
</ul>
<br/>
Finding the opcode : use windbg :<br/>
<br/>
0:014&gt; a<br/>
7c90120e jmp [esp + 8]<br/>
jmp [esp + 8]<br/>
7c901212 <br/>
<br/>
0:014&gt; u 7c90120e<br/>
ntdll!DbgBreakPoint:<br/>
7c90120e ff642408 &nbsp; &nbsp; &nbsp; &nbsp;jmp &nbsp; &nbsp; dword ptr [esp+8]<br/>
<br/>
The opcode is ff642408<br/>
<br/>
Now you can search for a dll that has this opcode, and use the address to overwrite EIP with. In our example, I could not find this exact opcode anywhere. Of course, you are not limited to looking for jmp [esp+8]… you could also look for values bigger than 8 (because you control anything above 8… you could easily put some additional NOP’s at the beginning of the shellcode and make the jump into the nop’s…<br/>
<br/>
(by the way: Opcode for ret is c3. But I’m sure you’ve already figured that our for yourself)</body></html>