<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Issues With Mingw</title>
</head><body><b>Scale</b><br/>
Whatever the reason, the Debian-packaged mingw flavor of gcc has a tendency to omit the instantiation of templates in many cases leading to missing symbols when linking. For instance, something like the following might sometimes complain that variants of scale can't be found on link,<br/>
<br/>
template &lt;class ty&gt; void scale(ty a, ty *X, unsigned n) {<br/>
&nbsp; for (int i = 0; i &lt; n; i++) X[i] = a * X[i];<br/>
}<br/>
void scale_ALL_the_things(float *A, int *B, unsigned n) {<br/>
&nbsp; scale(2.0, A, n);<br/>
&nbsp; scale( &nbsp;3, B, n);<br/>
<br/>
A horrible (but effective) solution I've found is to push the compile along with a dead function containing references to the template instantiations that you need,<br/>
<br/>
void __force_compile() {<br/>
&nbsp; scale&lt;float&gt;(0, 0, NULL);<br/>
&nbsp; scale&lt;int&gt;(0, 0, NULL);<br/>
}<br/>
<br/>
<b>C/C++ Standard Library Dependencies</b>&nbsp;<br/>
When compiling C projects, use {i686,x86_64}-w64-mingw32-gcc. The resulting binary will depend on at least KERNEL32.DLL and whatever MSVCRT.DLL is on clients' systems. Therefore, you'll need to make sure clients have the Microsoft C Runtime installed to use your software.<br/>
&nbsp;<br/>
When compiling a C++ project, you <b>must</b>&nbsp;use {i686,x86_64}-w64-mingw32-g++ to at least link. Otherwise, you'll find you are missing LIBSTDC++-6.DLL and/or LIBGCC_S_SJLJ-1.DLL.<br/>
&nbsp;<br/>
When shipping a C++ project, you'll need to include LIBSTDC++-6.DLL and/or LIBGCC_S_SJLJ-1.DLL with your install. You can grab these from your Linux install where you're performing the build in the associated MinGW directory, e.g., /usr/lib/gcc/x86_64-w64-mingw32/4.6/. Note that you can have gcc include these libraries statically by including the flags, -static-libgcc and -static-libstdc++<br/>
<br/>
<b>External Dependencies </b><br/>
If your project depends on external libraries, you'll need them available on your Linux machine during your build. I give some quick notes for the case where you'd like to use a pre-built (mingw) windows library and specific notes for Boost.<br/>
&nbsp;<br/>
Note that except for purely C external libraries, the libraries themselves must have been built with MinGW. The naming conventions of C++ symbols differ between MingGW and Visual Studio.<br/>
&nbsp;<br/>
Getting a MinGW build going for each project you might want to use is different. <a href="http://www.tinc-vpn.org/examples/cross-compiling-64-bit-windows-binary/">tinc's cross compilation page</a>&nbsp;gives instructions for a few libraries that it requires. You'll need to consult the documentation on a project-by-project basis for each of your dependencies.<br/>
<br/>
<b>Using a Prebuilt DLL From Windows (libpng)</b><br/>
LibPNG provides pre-built windows binaries (albeit ancient). To build with the library, download both the binary and developer packages and extract into the same directory. Do the same for zlib since LibPNG depends on it, as well.<br/>
<br/>
To build, give the compiler access to the appropriate include directories and link to the seemingly static .dll.a files. Do not attempt to link to the .dll files. Recall that linking to DLL's on Windows requires a .lib file at build-time; by convention (at least for GNU projects), these are named with a .dll.a extension,<br/>
<br/>
i686-w64-mingw32-gcc -Ilibpng/include -Izlib/include -o pngwriter.exe pngwriter.cc -Llibpng/lib -lpng -Lzlib/lib -lz<br/>
<br/>
<br/>
</body></html>