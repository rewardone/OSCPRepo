<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>General Primer</title>
</head><body>Windows privilege escalation has a very large attack surface due to the amount of legacy functionality and open sharing capabilities. Many security weaknesses have been left open as "it was designed that way" and may never be fixed. <br/>
<br/>
Some easy wins can be:<br/>
&nbsp;Passwords stored in clear or reversible format on public shares/filesystem<br/>
&nbsp;UAC Bypasses<br/>
&nbsp;DLL hijacking<br/>
&nbsp;Unquoted paths <br/>
&nbsp;OS Patches<br/>
<br/>
General Methodology:<ul><li>User wmic/other to enumerate patches. Look for privilege escalation exploits and look up their respective KB patch numbers.</li>
<li style="list-style-type: none"><ul><li>KiTrap0D (KB979682), MS11-011 (KB2393802), MS10-059 (KB982799), MS10-021 (KB979683), MS11-080 (KB2592799), and others</li>
</ul>
</li>
<li>Search for configuration files that may contain passwords:</li>
<li>Search for Group Policy Preference saved passwords</li>
<li>Search for Registry keys with saved passwords</li>
<li>Search files for passwords</li>
<li>Attempt write access to System32 Directory</li>
<li>Attempt write access to Startup folders</li>
<li>Attempt UAC Bypass (if prerequisites are met)</li>
<li>Search services for access misconfiguration</li>
<li style="list-style-type: none"><ul><li>Unquoted paths: place an .exe anywhere along the executable path</li>
<li>Folder permissions: replace the service's .exe</li>
<li>binpath permissions: replace the service's binpath variable</li>
<li>regkey permissions: replace the .exe path in the service's regkey (may be ImagePath)</li>
</ul>
</li>
<li>Search registry for misconfiguration: AlwaysInstallElevated among others</li>
<li>Scheduled Tasks (schtasks and AT)</li>
<li>User-defined service (Instrsrv.exe and Srvany.exe)</li>
<li>Others</li>
<li style="list-style-type: none"><ul><li>Crack hashes</li>
<li>Pass the hash</li>
<li>Token Impersonation</li>
<li>Keylogger</li>
<li>Network sniffer</li>
</ul>
</li>
</ul>
<br/>
HUGE NOTE FOR SYSINTERNALS TOOLS (accesschk and others)<br/>
When run for the first time, a GUI pop-up shows to have the user accept the EULA, pass the /accepteula flag to prevent this!<br/>
<br/>
A bit harder to use, but icacls is the built-in command for most of these tasks<br/>
<br/>
The defaults for checking permissions are: Accesschk (external), cacls (older version of:), icacls (built-in windows tool), and get-acl (powershell)</body></html>