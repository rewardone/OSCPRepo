<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Mitigations</title>
</head><body>Mitigations<br/>
So what can organizations do against these attacks? All the attacks above abuse the NLTM authentication protocol, so the only complete solution to this is <a href="https://technet.microsoft.com/en-us/library/jj865668%28v=ws.10%29.aspx">disabling NTLM entirely</a> and switching to Kerberos. Many organizations however have legacy products or operating systems that do not support Kerberos authentication, and thus disabling NTLM would have a considerate business impact. As a mitigating factor, there are several settings that can be enabled to minimize the risk of relaying.<br/>
<br/>
<b>Enable SMB signing</b>: SMB signing will prevent relaying to SMB by requiring all traffic to be signed. Signing requires the user password to authenticate the messages, and thus an attacker relaying the connection cannot send any traffic that will be accepted by the server, since the attacker does not possess the victim’s password.<br/>
<br/>
<b>Enable LDAP signing</b>: Similar to SMB signing, LDAP signing prevents unsigned connections to LDAP. It should be noted that connections to LDAP that happen over TLS are considered signed, so this setting will not prevent relay attacks to LDAP over TLS.<br/>
<br/>
<b>Enable extended protection for authentication</b>: <a href="https://msdn.microsoft.com/en-us/library/dd767318%28v=vs.90%29.aspx">Extended protection for authentication</a>&nbsp;helps prevent some relaying attacks by ensuring that the TLS channel used for the connection to the server is the same that the client uses when authenticating. This setting mainly applies to IIS.<br/>
<br/>
<b>Enable SPN target name validation</b>:<a href="https://technet.microsoft.com/en-us/library/jj852272%28v=ws.11%29.aspx">&nbsp;SPN target name validation</a>&nbsp;is another measure which prevents relaying to SMB by validating the target name to which the client thinks it is authenticating. If the name does not match with the server, the authentication is refused.<br/>
<br/>
<b>Ensure internal websites use HTTPS</b>: When internal websites are visited over the insecure HTTP protocol, there is no possible way for users to validate the authenticity of the connection. By enforcing all internal websites to only function over HTTPS, relaying becomes much less effective.<br/>
<br/>
<b>Disable automatic intranet detection</b>: If NTLM authentication is required in the domain, make sure that browsers (mainly Internet Explorer) only automatically authenticate to trusted websites. Via Group Policy it is possible to disable automatic intranet detection and only automatically authenticate to a whitelist of internal websites to which automatic authentication should apply. As mentioned previously, it is strongly recommended to only use HTTPS websites here.<br/>
<b><br/>
</b><b>Disable Windows Proxy Auto Detection</b>: While the security issues of WPAD have been mostly addressed by the Microsoft <a href="https://support.microsoft.com/en-us/help/3165191/ms16-077-security-update-for-wpad-june-14,-2016">MS16-077</a>security update, it is still recommended to disable WPAD in general via Group Policy.<br/>
<b><br/>
</b><b>Disable LLMNR/NBNS</b>: These insecure name resolution protocols are often not required in well configured networks. Disabling them gives an attacker fewer possibilities for name resolution spoofing, which in turn makes it harder for attackers to trick victims in connecting to the attackers server.<br/>
&nbsp;<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</body></html>