<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Viewing Trusts Graphically</title>
</head><body>While on a recent engagement where I had thousands of lines of trust relationships dumped from one Domain Controller, I developed a quick tool to parse the output from Veil PowerView and use the networkx library in python to analyze and plot it. This allowed me to quickly find a way to my target domain and helped me discover which systems would have access to the most shares for pillaging. It also forced me to look at the bigger picture and decide what major impacts this trust abuse could cause for my target organization.<br/>
<br/>
The script is a shell based wrapper for the networkx library and is specifically built for the trust.csv generated by PowerView. It provides basic analysis and output techniques. With it, you can get the top 5 most central nodes, find the shortest path between two domains, find isolated domains (those with only one neighbor), and dump the CSV data into a couple of formats (GML, GraphML) for viewing in your favorite visualization tool.<br/>
<br/>
The script can be found <a href="https://github.com/sixdub/DomainTrustExplorer">here</a>. Note: I used yEd on my Mac for image visualization. In order to get the colors and the labels to show on GraphML formats, you have to map the properties. I learned it <a href="http://thirld.com/blog/2012/01/31/making-yed-import-labels-from-graphml-files/">here</a>.<br/>
<br/>
Here are some screenshots from what I was able to do with a sample of data:<br/>
<br/>
*This output comes from a previous version that mapped trust direction. &nbsp;The current tool maps access direction since it was more useful. &nbsp;Simple flip of the arrows!<br/>
<br/>
<img src="image.png" /><br/>
<br/>
</body></html>