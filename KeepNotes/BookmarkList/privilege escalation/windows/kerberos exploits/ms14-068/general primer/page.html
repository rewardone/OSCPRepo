<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>General Primer</title>
</head><body>https://support.microsoft.com/en-us/help/3011780/ms14-068-vulnerability-in-kerberos-could-allow-elevation-of-privilege<br/>
https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2014/ms14-068<br/>
<br/>
Kerberos Checksum Vulnerability - CVE-2014-6324<br/>
A remote elevation of privilege vulnerability exists in implementations of Kerberos KDC in Microsoft Windows. The vulnerability exists when the Microsoft Kerberos KDC implementations fail to properly validate signatures, which can allow for certain aspects of a Kerberos service ticket to be forged. Microsoft received information about this vulnerability through coordinated vulnerability disclosure. When this security bulletin was issued, Microsoft was aware of limited, targeted attacks that attempt to exploit this vulnerability. Note that the known attacks did not affect systems running Windows Server 2012 or Windows Server 2012 R2. The update addresses the vulnerability by correcting signature verification behavior in Windows implementations of Kerberos.<br/>
<br/>
The Microsoft Windows Kerberos KDC fails to properly check for valid signatures in the Privilege Attribute Certificate (PAC) included with the Kerberos ticket request. A domain user may forge the information contained in the PAC to request higher user privileges than should be allowed. Since the KDC does not verify the signature correctly, it will award the user the requested privileges, effectively making the user a domain administrator and allowing complete compromise of the entire domain.<br/>
<br/>
Once the attacker has valid domain credentials (and local admin rights if Python install is required) on a computer on the network, they can leverage PyKEK to generate a forged TGT by performing standard communication with the target (unpatched) DC.<br/>
<br/>
Benjamin Delpy (author of Mimikatz) describes the actual vulnerability with how the PAC signature is checked during <a href="http://new.livestream.com/NTNU/passwords14/videos/70751388?t=1418474079423">his presentation at Passwords 2014</a>. According to his presentation, Benjamin notes the following:<br/>
<ul><li>Before the MS11-013 patch: PAC signature was valid if the checksum size was &lt;= to 20 (checksum &lt;= 20)</li>
<li>After the MS11-013 patch: PAC signature was valid if the checksum size was &lt;= 20 (checksum &lt;= 20) and the checksum is KEYED.</li>
<li>After MS14-068 patch: Microsoft added an additional verification step to ensure the checksum type is KRB_CHECKSUM_HMAC_MD5 (or AES in NT6)</li>
</ul>
<br/>
Requirements:<br/>
The bar is fairly low in order to exploit MS14-068. Effectively admin rights on a single domain-joined computer is all that’s needed. The other items aren’t that difficult once this access is attained.<ul><li>Admin access to a computer joined to the target domain</li>
<li>Access to domain credentials – a domain user account is fine.</li>
<li>Python exe’s on the computer.</li>
<li>Mimikatz on the computer</li>
<li style="list-style-type: none"></li>
</ul>
Basically, bug in Kerberos allows you to request higher privs than you actually have and Kerberos will grant your request. <br/>
</body></html>