<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Stage 1 Artifacts</title>
</head><body><b>Stage 1 Packet #1: TGT request (AS-REQ) with no PAC.</b>&nbsp; <br/>
<img src="image.png" /><br/>
<br/>
NOTE: The AS-REQ for the TGT requests a TGT with no PAC. <i>This may be useful for creating a Snort signature to detect attempted MS14-068 exploitation on the network.</i><b><br/>
</b>Compare this with a TGT request (AS-REQ) from a Windows client (Windows 7) which requests a PAC by default (click thumbnail to embiggen):<br/>
<img src="image 2.png" /><br/>
<br/>
<br/>
<b>Stage 1 Packet #2: TGT Response (AS-REP) which returns the KDC encrypted TGT to the client.</b>&nbsp; <br/>
<img src="image 3.png" /><br/>
<br/>
<br/>
<b>Stage 1 Packet #3: The TGS request notes no PAC should be included and there is an authenticator provided (the generated PAC).</b>&nbsp; <br/>
<img src="image 4.png" /><br/>
NOTE: The TGS-REQ provides the PAC as part of the request (though no PAC is requested). <i>This can be used to create an IDS signature to detect attempted MS14-068 exploitation on the network.</i><b><br/>
</b>Compare this with a TGS request (TGS-REQ) from a Windows client (Windows 7) which doesn’t have “include-pac:False”<br/>
<img src="image 5.png" /><br/>
<br/>
<br/>
<b>Stage 1 Packet #4: The TGS response includes the new TGT which uses MD5 (unkeyed).</b>&nbsp; <br/>
<img src="image 6.png" /><br/>
Compare this with a TGS response (TGS-REP) from a Windows client (Windows 7) in which the ticket component contains an “enc-part” with the etype: “eTYPE-AES256-CTS-HMAC-SHA1-96 (18)” which is a keyed SHA1 hash.<br/>
(click thumbnail to embiggen):<br/>
<img src="image 7.png" /><br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</body></html>