<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Token Impersonation</title>
</head><body>In Windows, everytime a user tries to log in, the system verifies that user’s password is correct by matching it with the one stored in the Security database: this is called “authentication process”. When the process succeed, the system generates an access token. Tokens can be seen as a temporary key so every process executed in the context of that user does not need to request the password again to run with user’s privileges: these are called “Delegation Tokens” and they persist on the system until next reboot. In fact, a user log off does not invalidate the token, but the token itself will be reported as an impersonation token instead of a delegation one.<br/>
<br/>
If a user connect to the compromised machine, it is possible to steal its relative token. This task can be performed with a Metasploit extension called Incognito.<br/>
<br/>
meterpreter &gt; load incognito<br/>
meterpreter &gt; list_tokens -u<br/>
meterpreter &gt; impersonate_token NET\\boss<br/>
<br/>
You'll get status if this succeeded or not. Now go back to shell and you'll have the access level of the token you are impersonating<br/>
<br/>
Other tools to help impersonate include:<br/>
RottonPotato<br/>
MWR Infosecurity <a href="https://labs.mwrinfosecurity.com/assets/BlogFiles/incognito2.zip">Ingcognito</a>&nbsp;<br/>
PowerSploit Invoke-TokenManipulation</body></html>