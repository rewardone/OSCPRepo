<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Macros</title>
</head><body>This type of attack is a Macro attack. The way this works is there is a Powershell script that runs 24/7 on the machine, which checks the default inbox for your email address and a specified subject at a given interval. When it sees your email, it shovels you a shell and deletes that email. <br/>
<br/>
There are 4 functions in the macro.<ul><li>Execute: Upon opening the document, it uses Invoke-Shellcode to shovel you a shell</li>
<li>Persist: This function writes a text file to C:\Users\Public, changes the extension to .vbs and sets the attributes to hidden. This .vbs file is a wrapper that executes Powershell and passes Persist.ps1 to it.</li>
<li>Reg: This function creates a registry key in HKCU\Software\Microsoft\Windows NT\CurrentVersion\Windows\Load that points to the hidden .vbs file. This ensures that the Powershell script starts back up after a reboot.</li>
<li>Start: This starts the script immediately</li>
</ul>
<br/>
To execute this, you create a document with a VBA macro and paste in the macro code (you need to update the IP address that your multi/handler is listening on). You then pull down Persist.ps1 and throw it on a public server. Once it is accessible, you need to change the email address, trigger word and IP address. Save the file and send the document off to the target. That is it.</body></html>