<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Goals, Value, Etc</title>
</head><body>What’s a *good* goal?<br/>
– Domain Admin is “A Goal” but it’s a stupid goal.<br/>
– What makes the client money is a better goal (if you* can identify it)<br/>
– Problems arise in actually identifying this. What’s important to testers vs client vs bad guys…<br/>
– Best goal, testing client’s ability to detect &amp; respond to various levels of attackers<br/>
<br/>
Finding stuff internally<br/>
--------------------------------<br/>
<br/>
GOOD<br/>
• Nmap<br/>
• Ping<br/>
• Nessus<br/>
• Nexpose<br/>
• Angry IP Scanner?<br/>
• “net view /domain”<br/>
<br/>
BETTER<br/>
• OSQL<br/>
– osql –L &nbsp;Lists all MS SQL servers<br/>
• DSQUERY / DSGET (Annoying)<br/>
– dsquery computer -limit 0 current domain<br/>
– dsquery user -limit 0<br/>
– dsquery computer -limit 0 "DC=company,DC=net"<br/>
– dsquery user -limit 0 "DC=company,DC=net“ other domain<br/>
– (Joeware) ADFind (less annoying)<br/>
• nltest<br/>
– Keeps trying to get you info if one path fails &nbsp;<br/>
<br/>
BEST<br/>
• Use the underlying API<br/>
• Railgun<br/>
• Demo<br/>
– Route<br/>
– ARPTable<br/>
– TCPTable<br/>
<br/>
User discovery<br/>
--------------------------------------<br/>
GOOD<br/>
• net group “domain admins” /domain<br/>
• net group “domain admins” /domain:DM<br/>
• net localgroup Administrators<br/>
• net group localgroup Administrators /domain<br/>
• net user domainadmin_username /domain<br/>
• net user username /domain<br/>
<br/>
BETTER<br/>
• Rpcclient<br/>
– Enumerate users<br/>
<br/>
BEST<br/>
• Explain UserDiscovery<br/>
• Demo UserDiscovery<br/>
• Explain DisplaySessions<br/>
• Demo DisplaySessions<br/>
• PVE-Find-AD-User<br/>
– https://www.corelan.be/index.php/my-freetools/ad-cs/pve-find-ad-user/<br/>
<br/>
Priv Escalation<br/>
-------------------------------------------<br/>
GOOD<br/>
• getsystem<br/>
• Post modules<br/>
– Keyboard layout<br/>
– Bypassuac<br/>
• Core Impact / Canvas ship with locals<br/>
– Honestly a big lacking area for MSF<br/>
<br/>
BETTER?<br/>
• Explain DomainDrop<br/>
<br/>
BEST<br/>
• Just ask for it…<br/>
• Explain ‘Ask’ module<br/>
• Looking for the user that has the $stuff<br/>
• Tasklist<br/>
– tasklist /V /S $IP /U $user /P $password<br/>
for /F "skip=3 delims=\ " %A in ('net view') do tasklist /V /S %A /U $user /P $password<br/>
<br/>
Searching for Loot<br/>
---------------------------------------------<br/>
Searching for Gold (Good)<br/>
• Dir /s “My Documents”<br/>
• Dir /s “Desktop”<br/>
• Dir /s *.pcf<br/>
• ListDrives<br/>
<br/>
Searching for Gold (Better)<br/>
• Dumplinks<br/>
• GetFirefoxCreds<br/>
• GetPidginCreds<br/>
• Outlook, IE, Chrome, RDP<br/>
Password Extraction<br/>
– Basically the whole ‘credentials’<br/>
post module section<br/>
• SharePoint<br/>
• Intranet.company.com<br/>
<br/>
Searching for Gold (Best)<br/>
• OpenDLP<br/>
• Fiction’s Database Searcher<br/>
• Search in Meterpreter<br/>
– Uses windows indexing i.e. outlook email<br/>
• Dir /s $share &gt; filetosearchoffline.txt<br/>
– Findstr too <br/>
– Do what works for you…click scripts rule<br/>
<br/>
Pivoting<br/>
-----------------------------------------------<br/>
Portforwarding<br/>
– Meterpreter portfwd<br/>
– Route<br/>
– Sock4a module + meterpreter session<br/>
– Pro VPN Pivot?<br/>
• Portproxy<br/>
– Built into Windows<br/>
– netsh interface portproxy&gt;add v4tov4<br/>
listenport=25 connectaddress=192.168.0.100<br/>
connectport=80 protocol=tcp<br/>
• Legitimate Access via VPN, Term Server, Citrix, etc<br/>
<br/>
<br/>
Persistence<br/>
-----------------------------------------------------<br/>
Smartlocker -&gt; lockout_recorder<br/>
– http://blog.metasploit.com/2010/12/capturing-windows-logonswith.html<br/>
• Fxsst.dll<br/>
– https://blog.mandiant.com/archives/1786<br/>
– http://www.room362.com/blog/2011/6/27/fxsstdll-persistence-theevil-fax-machine.html<br/>
• Explain gpo_dropper hbgary<br/>
– http://www.hbgary.com/malware-using-local-group-policy<br/>
• Explain IPv6 Dropper<br/>
– http://hak5.org/hack/ipv6-from-the-pentesters-perspective<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
</body></html>